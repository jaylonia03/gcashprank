<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SW Tracker - Spending Tracker for SW</title>
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --glass-color: rgba(255, 255, 255, 0.15);
            --text-color: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.2);
            --card-bg: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            min-height: 100vh;
            overflow: hidden;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header {
            padding: 15px;
            text-align: center;
            background: var(--glass-color);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-color);
            z-index: 10;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .total-balance {
            padding: 20px;
            text-align: center;
            background: var(--glass-color);
            margin: 10px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .total-balance-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .total-amount {
            font-size: 2rem;
            font-weight: 700;
        }

        .nav-tabs {
            display: flex;
            background: var(--glass-color);
            backdrop-filter: blur(10px);
            margin: 0 10px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px var(--shadow-color);
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .nav-tab.active {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            -webkit-overflow-scrolling: touch;
        }

        .bank-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .bank-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px var(--shadow-color);
            border: 1px solid var(--glass-color);
            transition: transform 0.2s;
        }

        .bank-card:active {
            transform: scale(0.98);
        }

        .bank-logo {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin-right: 12px;
            object-fit: contain;
            background-color: white;
            padding: 3px;
        }

        .bank-info {
            flex: 1;
        }

        .bank-name {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .bank-balance {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .transactions-section {
            margin-top: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 5px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .view-all {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .transaction-list {
            background: var(--glass-color);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            overflow: hidden;
        }

        .transaction-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-title {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 3px;
        }

        .transaction-note {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .transaction-amount {
            font-weight: 600;
            font-size: 1rem;
        }

        .positive {
            color: #4ade80;
        }

        .negative {
            color: #f87171;
        }

        .bank-details-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--glass-color);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .bank-details-logo {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            margin-right: 15px;
            object-fit: contain;
            background-color: white;
            padding: 5px;
        }

        .bank-details-info {
            flex: 1;
        }

        .bank-details-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .bank-details-balance {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            background-color: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-color);
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .transaction-actions {
            display: flex;
            gap: 5px;
        }

        .transaction-action-btn {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .transaction-action-btn:active {
            transform: scale(0.95);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(106, 17, 203, 0.9), rgba(37, 117, 252, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(20px);
            transition: transform 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
        }

        .form-radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-radio {
            display: none;
        }

        .form-radio-label {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .form-radio:checked + .form-radio-label {
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: 500;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background-color: white;
            color: var(--primary-color);
        }

        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-danger {
            background-color: rgba(239, 68, 68, 0.8);
            color: white;
        }

        .search-bar {
            padding: 10px;
            background-color: var(--glass-color);
            backdrop-filter: blur(10px);
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
        }

        .search-input {
            flex: 1;
            background: none;
            border: none;
            color: white;
            padding: 8px;
            font-size: 1rem;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.7;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1rem;
        }

        @media (max-width: 400px) {
            .bank-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>SW Tracker</h1>
        </div>

        <div class="total-balance">
            <div class="total-balance-label">Total Balance</div>
            <div class="total-amount" id="totalBalance">‚Ç±0.00</div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" id="homeNav">Home</div>
            <div class="nav-tab" id="transactionsNav">Transactions</div>
        </div>

        <div class="content" id="mainContent">
            <div class="bank-cards" id="bankCards">
                <!-- Bank cards will be dynamically inserted here -->
            </div>

            <div class="transactions-section">
                <div class="section-header">
                    <div class="section-title">Recent Transactions</div>
                    <div class="view-all" id="viewAllTransactions">View All</div>
                </div>
                <div class="transaction-list" id="recentTransactions">
                    <!-- Recent transactions will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <div class="content" id="transactionsContent" style="display: none;">
            <div class="search-bar">
                <input type="text" class="search-input" id="transactionSearch" placeholder="Search transactions...">
            </div>
            <div class="transaction-list" id="allTransactions">
                <!-- All transactions will be dynamically inserted here -->
            </div>
        </div>

        <div class="content" id="bankDetailsContent" style="display: none;">
            <div class="bank-details-header" id="bankDetailsHeader">
                <!-- Bank details header will be dynamically inserted here -->
            </div>
            <div class="action-buttons">
                <button class="action-btn" id="addFundsBtn">
                    <span>Add</span>
                </button>
                <button class="action-btn" id="deductFundsBtn">
                    <span>Deduct</span>
                </button>
                <button class="action-btn" id="resetBankBtn">
                    <span>Reset</span>
                </button>
            </div>
            <div class="transaction-list" id="bankTransactions">
                <!-- Bank transactions will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Add Transaction Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Add Funds</div>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="transactionForm">
                    <input type="hidden" id="transactionType">
                    <input type="hidden" id="selectedBankId">
                    <div class="form-group">
                        <label class="form-label" for="amount">Amount</label>
                        <input type="number" class="form-input" id="amount" placeholder="Enter amount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="note">Note (Optional)</label>
                        <input type="text" class="form-input" id="note" placeholder="e.g. Received from casino">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelTransaction">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="submitTransaction">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirm Reset Modal -->
    <div class="modal" id="confirmResetModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Confirm Reset</div>
                <button class="close-modal" id="closeResetModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset all data? This action cannot be undone.</p>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelReset">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmReset">Reset All</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bank data
        const banks = [
            { id: 'gcash', name: 'Gcash', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvp4okMup6ECipec_459pnzqy1CY-QfrsX9TYB73hGXKf41ysBNJZGA9LG&s=10', balance: 0 },
            { id: 'maya', name: 'Maya', logo: 'https://play-lh.googleusercontent.com/fdQjxsIO8BTLaw796rQPZtLEnGEV8OJZJBJvl8dFfZLZcGf613W93z7y9dFAdDhvfqw=w600-h300-pc0xffffff-pd', balance: 0 },
            { id: 'atome', name: 'Atome', logo: 'https://www.atome.ph/assets/common/icon-square.png', balance: 0 },
            { id: 'gotyme', name: 'Gotyme', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSuaK10P10NDO4YqjlBUdW0QkfE2h_KKSm3A&s', balance: 0 },
            { id: 'cimb', name: 'CIMB', logo: 'https://companieslogo.com/img/orig/1023.KL-a086521a.png?t=1720244490', balance: 0 },
            { id: 'paypal', name: 'Paypal', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSYVt-L3PMTzpdS_eSrQZMFr1mXm6zxt4j8el-OS9_qkXCV1IMOb3Ekti0&s=10', balance: 0 },
            { id: 'seabank', name: 'Seabank', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQO6Zc_bp1u6EGZBh984qGMmQhP_06YtdzUynyPXNaqM4EiGzwdA2YV6M8&s=10', balance: 0 },
            { id: 'unionbank', name: 'Unionbank', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmpnGncwP99Qid8PQ6WflM7VrMdXePK-HjEhCYYrtzb2X9-546uR2f9Qo&s=10', balance: 0 },
            { id: 'cebuana', name: 'Cebuana e savings', logo: 'https://play-lh.googleusercontent.com/LPRgXLcUBJfmryYyenSY38JEen3ALjNpF61xPcNdxy_mpLlbbY9IX5RwPP0bOq4GCEI', balance: 0 },
            { id: 'wise', name: 'Wise', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT8dtjabGWo3kulV-Ha5qCQgU8kA2E-RvUCFA3J4h0oBsT4A8yA4MCxfuI&s=10', balance: 0 }
        ];

        // Transactions data
        let transactions = [];

        // DOM elements
        const totalBalanceEl = document.getElementById('totalBalance');
        const bankCardsEl = document.getElementById('bankCards');
        const recentTransactionsEl = document.getElementById('recentTransactions');
        const allTransactionsEl = document.getElementById('allTransactions');
        const bankTransactionsEl = document.getElementById('bankTransactions');
        const viewAllTransactionsEl = document.getElementById('viewAllTransactions');
        const transactionSearchEl = document.getElementById('transactionSearch');
        const mainContentEl = document.getElementById('mainContent');
        const transactionsContentEl = document.getElementById('transactionsContent');
        const bankDetailsContentEl = document.getElementById('bankDetailsContent');
        const bankDetailsHeaderEl = document.getElementById('bankDetailsHeader');
        const homeNavEl = document.getElementById('homeNav');
        const transactionsNavEl = document.getElementById('transactionsNav');
        const transactionModalEl = document.getElementById('transactionModal');
        const modalTitleEl = document.getElementById('modalTitle');
        const transactionTypeEl = document.getElementById('transactionType');
        const selectedBankIdEl = document.getElementById('selectedBankId');
        const amountEl = document.getElementById('amount');
        const noteEl = document.getElementById('note');
        const transactionFormEl = document.getElementById('transactionForm');
        const closeModalEl = document.getElementById('closeModal');
        const cancelTransactionEl = document.getElementById('cancelTransaction');
        const addFundsBtnEl = document.getElementById('addFundsBtn');
        const deductFundsBtnEl = document.getElementById('deductFundsBtn');
        const resetBankBtnEl = document.getElementById('resetBankBtn');
        const confirmResetModalEl = document.getElementById('confirmResetModal');
        const closeResetModalEl = document.getElementById('closeResetModal');
        const cancelResetEl = document.getElementById('cancelReset');
        const confirmResetEl = document.getElementById('confirmReset');

        // Current view state
        let currentBankId = null;

        // Initialize the app
        function init() {
            loadData();
            renderBankCards();
            renderRecentTransactions();
            updateTotalBalance();
            setupEventListeners();
        }

        // Load data from localStorage
        function loadData() {
            const savedBanks = localStorage.getItem('swTracker_banks');
            const savedTransactions = localStorage.getItem('swTracker_transactions');

            if (savedBanks) {
                const parsedBanks = JSON.parse(savedBanks);
                banks.forEach(bank => {
                    const savedBank = parsedBanks.find(b => b.id === bank.id);
                    if (savedBank) {
                        bank.balance = savedBank.balance;
                    }
                });
            }

            if (savedTransactions) {
                transactions = JSON.parse(savedTransactions);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('swTracker_banks', JSON.stringify(banks));
            localStorage.setItem('swTracker_transactions', JSON.stringify(transactions));
        }

        // Render bank cards
        function renderBankCards() {
            bankCardsEl.innerHTML = '';
            banks.forEach(bank => {
                const bankCard = document.createElement('div');
                bankCard.className = 'bank-card';
                bankCard.dataset.bankId = bank.id;
                bankCard.innerHTML = `
                    <img src="${bank.logo}" alt="${bank.name}" class="bank-logo">
                    <div class="bank-info">
                        <div class="bank-name">${bank.name}</div>
                        <div class="bank-balance">‚Ç±${bank.balance.toFixed(2)}</div>
                    </div>
                `;
                bankCardsEl.appendChild(bankCard);
            });
        }

        // Render recent transactions (last 5)
        function renderRecentTransactions() {
            const recentTransactions = transactions.slice(0, 5);
            renderTransactions(recentTransactions, recentTransactionsEl);
        }

        // Render all transactions
        function renderAllTransactions() {
            renderTransactions(transactions, allTransactionsEl);
        }

        // Render bank-specific transactions
        function renderBankTransactions(bankId) {
            const bankTransactions = transactions.filter(t => t.bankId === bankId);
            renderTransactions(bankTransactions, bankTransactionsEl);
        }

        // Generic transaction renderer
        function renderTransactions(transactionsToRender, container) {
            container.innerHTML = '';

            if (transactionsToRender.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div class="empty-icon">üì≠</div>
                    <div class="empty-text">No transactions found</div>
                `;
                container.appendChild(emptyState);
                return;
            }

            transactionsToRender.forEach(transaction => {
                const bank = banks.find(b => b.id === transaction.bankId);
                const transactionItem = document.createElement('div');
                transactionItem.className = 'transaction-item';
                transactionItem.innerHTML = `
                    <div class="transaction-icon">
                        ${transaction.type === 'add' ? '‚ûï' : '‚ûñ'}
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-title">${bank.name}</div>
                        <div class="transaction-note">${transaction.note || 'No note'}</div>
                    </div>
                    <div class="transaction-amount ${transaction.type === 'add' ? 'positive' : 'negative'}">
                        ${transaction.type === 'add' ? '+' : '-'}‚Ç±${transaction.amount.toFixed(2)}
                    </div>
                    <div class="transaction-actions">
                        <button class="transaction-action-btn delete-transaction" data-transaction-id="${transaction.id}">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(transactionItem);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-transaction').forEach(btn => {
                btn.addEventListener('click', function() {
                    const transactionId = this.dataset.transactionId;
                    deleteTransaction(transactionId);
                });
            });
        }

        // Update total balance
        function updateTotalBalance() {
            const total = banks.reduce((sum, bank) => sum + bank.balance, 0);
            totalBalanceEl.textContent = `‚Ç±${total.toFixed(2)}`;
        }

        // Add a transaction
        function addTransaction(bankId, type, amount, note) {
            const transaction = {
                id: Date.now().toString(),
                bankId,
                type,
                amount: parseFloat(amount),
                note,
                date: new Date().toISOString()
            };

            // Update bank balance
            const bank = banks.find(b => b.id === bankId);
            if (bank) {
                if (type === 'add') {
                    bank.balance += transaction.amount;
                } else {
                    bank.balance -= transaction.amount;
                    // Ensure balance doesn't go negative
                    if (bank.balance < 0) bank.balance = 0;
                }
            }

            // Add to transactions array
            transactions.unshift(transaction);

            // Update UI and save
            renderBankCards();
            updateTotalBalance();
            saveData();

            // Update the appropriate transactions view based on current view
            if (currentBankId) {
                renderBankTransactions(currentBankId);
            } else if (transactionsContentEl.style.display !== 'none') {
                renderAllTransactions();
            } else {
                renderRecentTransactions();
            }
        }

        // Delete a transaction
        function deleteTransaction(transactionId) {
            const transactionIndex = transactions.findIndex(t => t.id === transactionId);
            if (transactionIndex === -1) return;

            const transaction = transactions[transactionIndex];
            const bank = banks.find(b => b.id === transaction.bankId);

            if (bank) {
                // Reverse the transaction's effect on the balance
                if (transaction.type === 'add') {
                    bank.balance -= transaction.amount;
                } else {
                    bank.balance += transaction.amount;
                }
                // Ensure balance doesn't go negative
                if (bank.balance < 0) bank.balance = 0;
            }

            // Remove the transaction
            transactions.splice(transactionIndex, 1);

            // Update UI and save
            renderBankCards();
            updateTotalBalance();
            saveData();

            // Update the appropriate transactions view based on current view
            if (currentBankId) {
                renderBankTransactions(currentBankId);
            } else if (transactionsContentEl.style.display !== 'none') {
                renderAllTransactions();
            } else {
                renderRecentTransactions();
            }
        }

        // Reset all data
        function resetAllData() {
            // Reset bank balances
            banks.forEach(bank => {
                bank.balance = 0;
            });

            // Clear transactions
            transactions = [];

            // Update UI and save
            renderBankCards();
            updateTotalBalance();
            renderRecentTransactions();
            if (currentBankId) {
                renderBankTransactions(currentBankId);
            } else if (transactionsContentEl.style.display !== 'none') {
                renderAllTransactions();
            }
            saveData();
        }

        // Show bank details
        function showBankDetails(bankId) {
            const bank = banks.find(b => b.id === bankId);
            if (!bank) return;

            currentBankId = bankId;

            // Update bank details header
            bankDetailsHeaderEl.innerHTML = `
                <img src="${bank.logo}" alt="${bank.name}" class="bank-details-logo">
                <div class="bank-details-info">
                    <div class="bank-details-name">${bank.name}</div>
                    <div class="bank-details-balance">‚Ç±${bank.balance.toFixed(2)}</div>
                </div>
            `;

            // Render bank transactions
            renderBankTransactions(bankId);

            // Switch to bank details view
            mainContentEl.style.display = 'none';
            transactionsContentEl.style.display = 'none';
            bankDetailsContentEl.style.display = 'block';

            // Update nav
            homeNavEl.classList.remove('active');
            transactionsNavEl.classList.remove('active');
        }

        // Show home view
        function showHomeView() {
            currentBankId = null;
            mainContentEl.style.display = 'block';
            transactionsContentEl.style.display = 'none';
            bankDetailsContentEl.style.display = 'none';
            homeNavEl.classList.add('active');
            transactionsNavEl.classList.remove('active');
        }

        // Show transactions view
        function showTransactionsView() {
            currentBankId = null;
            mainContentEl.style.display = 'none';
            transactionsContentEl.style.display = 'block';
            bankDetailsContentEl.style.display = 'none';
            renderAllTransactions();
            homeNavEl.classList.remove('active');
            transactionsNavEl.classList.add('active');
        }

        // Open transaction modal
        function openTransactionModal(bankId, type) {
            const bank = banks.find(b => b.id === bankId);
            if (!bank) return;

            transactionTypeEl.value = type;
            selectedBankIdEl.value = bankId;
            modalTitleEl.textContent = type === 'add' ? `Add to ${bank.name}` : `Deduct from ${bank.name}`;
            amountEl.value = '';
            noteEl.value = '';
            transactionModalEl.classList.add('active');
        }

        // Close transaction modal
        function closeTransactionModal() {
            transactionModalEl.classList.remove('active');
        }

        // Open confirm reset modal
        function openConfirmResetModal() {
            confirmResetModalEl.classList.add('active');
        }

        // Close confirm reset modal
        function closeConfirmResetModal() {
            confirmResetModalEl.classList.remove('active');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Bank card clicks
            document.querySelectorAll('.bank-card').forEach(card => {
                card.addEventListener('click', function() {
                    const bankId = this.dataset.bankId;
                    showBankDetails(bankId);
                });
            });

            // View all transactions
            viewAllTransactionsEl.addEventListener('click', showTransactionsView);

            // Transaction search
            transactionSearchEl.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredTransactions = transactions.filter(t => {
                    const bank = banks.find(b => b.id === t.bankId);
                    const bankNameMatches = bank.name.toLowerCase().includes(searchTerm);
                    const noteMatches = t.note && t.note.toLowerCase().includes(searchTerm);
                    return bankNameMatches || noteMatches;
                });
                renderTransactions(filteredTransactions, allTransactionsEl);
            });

            // Navigation
            homeNavEl.addEventListener('click', showHomeView);
            transactionsNavEl.addEventListener('click', showTransactionsView);

            // Transaction modal
            closeModalEl.addEventListener('click', closeTransactionModal);
            cancelTransactionEl.addEventListener('click', closeTransactionModal);
            transactionFormEl.addEventListener('submit', function(e) {
                e.preventDefault();
                const amount = amountEl.value;
                const note = noteEl.value;
                const type = transactionTypeEl.value;
                const bankId = selectedBankIdEl.value;

                if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }

                addTransaction(bankId, type, amount, note);
                closeTransactionModal();
            });

            // Bank details actions
            addFundsBtnEl.addEventListener('click', function() {
                openTransactionModal(currentBankId, 'add');
            });

            deductFundsBtnEl.addEventListener('click', function() {
                openTransactionModal(currentBankId, 'deduct');
            });

            resetBankBtnEl.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset this bank? All transactions for this bank will be deleted and balance will be set to zero.')) {
                    // Reset this bank's balance
                    const bank = banks.find(b => b.id === currentBankId);
                    if (bank) {
                        bank.balance = 0;
                    }

                    // Remove all transactions for this bank
                    transactions = transactions.filter(t => t.bankId !== currentBankId);

                    // Update UI and save
                    renderBankCards();
                    updateTotalBalance();
                    renderBankTransactions(currentBankId);
                    saveData();
                }
            });

            // Confirm reset modal
            closeResetModalEl.addEventListener('click', closeConfirmResetModal);
            cancelResetEl.addEventListener('click', closeConfirmResetModal);
            confirmResetEl.addEventListener('click', function() {
                resetAllData();
                closeConfirmResetModal();
            });

            // Handle back button (for mobile)
            window.addEventListener('popstate', function() {
                showHomeView();
            });
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
